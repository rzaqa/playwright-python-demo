name: E2E UI Tests

on:
  workflow_call:
    inputs:
      python-version:
        required: false
        default: "3.13"
        type: string

env:
  ENV_TYPE: CI
  HEADLESS: "true"
  BASE_URL: ${{ secrets.BASE_URL }}
  GRAPHQL_URL: ${{ secrets.GRAPHQL_URL }}
  ADMIN_NAME: ${{ secrets.ADMIN_NAME }}
  ADMIN_PASSW: ${{ secrets.ADMIN_PASSW }}
  HOME: /root

jobs:
  e2e-tests:
    runs-on: ubuntu-latest
    container:
      image: mcr.microsoft.com/playwright:v1.47.0-jammy
    timeout-minutes: 15

    steps:
      - name: 🛒 Checkout repository
        uses: actions/checkout@v4

      - name: 🐍 Install Python
        run: |
          apt-get update && apt-get install -y python3 python3-pip
          python3 -m pip install --upgrade pip

      - name: 🧰 Install dependencies
        run: |
          python -m ensurepip --upgrade
          python -m pip install --upgrade pip
          python -m pip install -r requirements.txt
          python -m playwright install --with-deps

      - name: 🧪 Run E2E tests
        run: |
          pytest tests/e2e -v -s --alluredir=allure-results

      - name: 📦 Upload Allure results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: allure-results-e2e
          path: allure-results
